async function runLionMailBriefing() {
            const container = document.getElementById('brief-content');
            container.innerHTML = `<p class="text-center py-40 text-xs italic tracking-widest uppercase text-gray-400 animate-pulse">Syncing Executive Data...</p>`;

            try {
                const now = new Date();
                const tomorrow = new Date(now.getTime() + (24 * 60 * 60 * 1000));
                const dateString = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });

                // We use individual try/catch for each fetch so one failure doesn't hang the whole app t
                let inbox, calendar, holidays, tasks, scheduled;

                try {
                    [inbox, calendar, holidays, tasks, scheduled] = await Promise.all([
                        gapi.client.gmail.users.messages.list({ userId: 'me', q: 'is:unread label:inbox' }),
                        gapi.client.calendar.events.list({ calendarId: 'primary', timeMin: now.toISOString(), singleEvents: true, orderBy: 'startTime', maxResults: 50 }),
                        gapi.client.calendar.events.list({ calendarId: 'en.usa#holiday@group.v.calendar.google.com', timeMin: now.toISOString(), singleEvents: true, orderBy: 'startTime', maxResults: 5 }),
                        gapi.client.tasks.tasks.list({ tasklist: '@default', showCompleted: false, showHidden: false }),
                        gapi.client.gmail.users.messages.list({ userId: 'me', q: 'label:scheduled' })
                    ]);
                } catch (apiErr) {
                    console.error("Google API Fetch Error:", apiErr);
                    container.innerHTML = `<p class="text-center py-40 text-xs text-red-500 uppercase">Google Sync Failed. Check Connection.</p>`;
                    return;
                }

                // --- 1. Calendar Processing ---
                const activeEvents = (calendar.result.items || [])
                    .filter(e => e.status !== 'cancelled')
                    .map(e => {
                        const start = new Date(e.start.dateTime || e.start.date);
                        const end = new Date(e.end.dateTime || e.end.date);
                        return {
                            summary: e.summary, start, end, 
                            raw: `- ${e.summary}: ${start.toLocaleString()} to ${end.toLocaleTimeString()}`
                        };
                    });

                const holidayEvents = (holidays.result.items || []).map(h => `- HOLIDAY: ${h.summary} on ${h.start.date}`);

                // --- 2. Email Processing ---
                let emailContext = "None.";
                if (inbox.result.messages) {
                    const details = await Promise.all(inbox.result.messages.slice(0, 10).map(m => gapi.client.gmail.users.messages.get({ userId: 'me', id: m.id })));
                    emailContext = details.map(d => `From: ${cleanText(d.result.payload.headers.find(h=>h.name==='From').value)} | Subj: ${cleanText(d.result.payload.headers.find(h=>h.name==='Subject').value)}`).join('\n');
                }

                // --- 3. Scheduled Audit Context ---
                let scheduledContext = "None.";
                if (scheduled.result.messages) {
                    const scheduledDetails = await Promise.all(scheduled.result.messages.slice(0, 5).map(m => gapi.client.gmail.users.messages.get({ userId: 'me', id: m.id })));
                    scheduledContext = scheduledDetails.map(d => `Subject: "${cleanText(d.result.payload.headers.find(h=>h.name==='Subject')?.value)}" | Snippet: ${cleanText(d.result.snippet)}`).join('\n');
                }

                // --- 4. Task Filtering (STRICT: No completed tasks) ---
                const pendingTasks = (tasks.result.items || []).filter(t => t.status === 'needsAction');

                // --- 5. AI Call (REVERTED TO DIRECT STABLE MODEL) ---
                const briefingPrompt = `DATE: ${dateString}.
                CALENDAR: ${activeEvents.map(e => e.raw).join('\n')}
                HOLIDAYS: ${holidayEvents.join('\n')}
                EMAILS: ${emailContext}
                PENDING TASKS (Incomplete only): ${pendingTasks.map(t => t.title).join('\n')}
                FORMATTING:
                    - Use "Daily Summary" style.
                    - Sections: ðŸ“§ Recent Email Activity, ðŸ“… Today's Calendar Events, âš ï¸ SCHEDULING CONFLICT DETECTED, ðŸ“‹ Action Items.
                    - HIGHLIGHT: Overlapping events using ðŸš¨.`;

                const auditPrompt = `Review for typos/firm name alignment.
                EMAILS: ${scheduledContext}
                Format: ðŸ“§ [Subject] â€” [âœ… Clean / âš ï¸ Typo Found]`;

                // Parallel AI calls
                const [aiBriefing, aiAudit] = await Promise.all([
                    getAIResponse(briefingPrompt),
                    getAIResponse(auditPrompt)
                ]);

                // --- 6. UI Render ---
                const next24h = activeEvents.filter(e => e.start > now && e.start <= tomorrow).slice(0, 6);

                container.innerHTML = `
                    <section class="animate-fade-in">
                        <div class="paul-weiss-container prose prose-sm max-w-none">${marked.parse(aiBriefing)}</div>
                    </section>
                    <section class="schedule-block animate-fade-in prose prose-sm max-w-none">
                        <h2 class="text-[10px] font-bold uppercase tracking-[0.4em] text-gray-400 mb-4 pb-2 border-b">Outgoing Correspondence Audit</h2>
                        ${marked.parse(aiAudit)}
                    </section>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mt-12">
                        <section>
                            <h2 class="text-[10px] font-bold uppercase tracking-[0.4em] text-gray-400 mb-6 border-b pb-2">Verified Schedule (Next 24h)</h2>
                            <div class="space-y-1">
                                ${next24h.map(e => `
                                    <div class="time-card">
                                        <div class="time-meta">
                                            <p class="text-[10px] font-bold text-[#1D3557] uppercase">${e.start.toLocaleDateString([], {month:'short', day:'numeric'})}</p>
                                            <p class="text-[9px] text-gray-400 italic">${e.start.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</p>
                                        </div>
                                        <div class="event-details">
                                            <p class="text-sm font-bold text-[#1D3557]">${e.summary}</p>
                                        </div>
                                    </div>`).join('') || '<p class="text-xs text-gray-400">Clear.</p>'}
                            </div>
                        </section>
                        <section>
                            <h2 class="text-[10px] font-bold uppercase tracking-[0.4em] text-gray-400 mb-6 border-b pb-2">Pending Matters</h2>
                            <div class="space-y-3">
                                ${pendingTasks.map(t => `
                                    <div class="p-4 bg-white border border-gray-100 text-[11px] font-medium text-gray-700 flex items-center gap-4">
                                        <div class="w-1.5 h-1.5 bg-gray-300"></div> ${t.title}
                                    </div>`).join('') || '<p class="text-xs text-gray-400">All tasks completed.</p>'}
                            </div>
                        </section>
                    </div>`;
            } catch (err) {
                console.error("General Error:", err);
                container.innerHTML = `<p class="text-center py-40 text-xs text-red-500 uppercase">Critical Error. Please refresh.</p>`;
            }
        }
